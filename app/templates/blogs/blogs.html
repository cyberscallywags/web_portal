{% extends "base.html" %}
{% block title %}Blogs - Cyber Scallywags{% endblock %}
{% block content %}

<section class="hero">
  <div class="container">
    <h1 style="color: #C1E415;">üìù Cyber Scallywags Blog</h1>
    <p style="color: #00B1B3;" class="tagline">Stories, insights, and adventures from the pack that codes for the people.</p>
  </div>
</section>

<!-- Filter and Search Section -->
<section class="filter-section py-3">
  <div class="container">
    <div class="row g-3">
      <div class="col-md-8">
        <input type="text" id="searchInput" class="form-control" placeholder="Search blog posts..." style="border-color: #C1E415;">
      </div>
      <div class="col-md-4">
        <select id="tagFilter" class="form-select" style="border-color: #C1E415;">
          <option value="">All Categories</option>
          <option value="technology">Technology</option>
          <option value="community">Community</option>
          <option value="education">Education</option>
          <option value="open-source">Open Source</option>
          <option value="tutorials">Tutorials</option>
          <option value="events">Events</option>
        </select>
      </div>
    </div>
  </div>
</section>

<!-- Blog Posts Grid -->
<section class="blog-posts py-4">
  <div class="container">
    <div class="row g-4" id="blogGrid">
      <!-- Blog posts will be loaded here via JavaScript -->
    </div>
  </div>
</section>

<!-- Pagination -->
<section class="pagination-section py-3">
  <div class="container">
    <nav aria-label="Blog pagination">
      <ul class="pagination justify-content-center" id="paginationNav">
        <!-- Pagination will be generated by JavaScript -->
      </ul>
    </nav>
  </div>
</section>

<style>
.hero {
  background: linear-gradient(120deg, #161a3a, #3a1d5e, #0e6abd);
  color: #fff;
  padding: 3rem 0;
  margin-bottom: 2rem;
}

.filter-section {
  background-color: rgba(193, 228, 21, 0.1);
}

.blog-card {
  border: 1px solid #e6e6ef;
  border-radius: 16px;
  overflow: hidden;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  height: 100%;
  cursor: pointer;
}

.blog-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.blog-featured-image {
  width: 100%;
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  background-color: #4006a7;
  transition: filter 0.3s ease;
}

.blog-featured-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  object-position: center;
}

.blog-card:hover .blog-featured-image {
  filter: brightness(1.1);
}

.blog-card-body {
  padding: 1.25rem;
}

.blog-title {
  color: #333;
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
  line-height: 1.3;
}

.blog-excerpt {
  color: #666;
  font-size: 0.95rem;
  line-height: 1.5;
  margin-bottom: 1rem;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.blog-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.85rem;
  color: #888;
  margin-bottom: 1rem;
}

.blog-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.blog-tag {
  background: linear-gradient(45deg, #4006a7, #C1E415);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.8rem;
  text-decoration: none;
  transition: opacity 0.2s ease;
}

.blog-tag:hover {
  opacity: 0.8;
  color: white;
}

.author-info {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.author-avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: #C1E415;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #4006a7;
  font-weight: bold;
}

.read-time {
  color: #C1E415;
  font-weight: 500;
}

/* Responsive Design */
@media (max-width: 768px) {
  .hero {
    padding: 2rem 0;
  }
  
  .blog-featured-image {
    height: 150px;
    font-size: 2rem;
  }
  
  .filter-section .row {
    flex-direction: column;
  }
}
</style>

<script>
// Sample blog data - this would typically come from your API
const blogData = {
  "blogs": [
    {
      "id": 1,
      "title": "Building Communities Through Code: The Cyber Scallywags Way",
      "slug": "building-communities-through-code",
      "excerpt": "Discover how we're using technology to bring people together and create lasting change in our communities. From workshops to open-source projects, learn about our grassroots approach.",
      "content": "Full blog content goes here...",
      "author": {
        "name": "Colin Moore-Hill",
        "avatar": "/static/images/team/colin/pic.jpeg",
        "bio": "Founder & Community Lead"
      },
      "published_date": "2025-10-25T10:00:00Z",
      "featured_image": "/static/images/logo/CyberScallywags.png",
      "tags": ["community", "technology", "Civic Tech"],
      "read_time": "5 min read",
      "status": "published",
      "views": 12,
      "featured": true
    },
    {
      "id": 2,
      "title": "The DSF Companion: From Conversations to Connections",
      "slug": "the-dsf-companion",
      "excerpt": "Explore the DSF Companion, a platform designed to foster meaningful conversations and connections within the data community.",
      "content": "Full blog content goes here...",
      "author": {
        "name": "Kishion Layne",
        "avatar": "/static/images/authors/marcus.jpg",
        "bio": "Python Developer & Educator"
      },
      "published_date": "2025-10-20T14:30:00Z",
      "featured_image": "/static/images/logo/logo.png",
      "tags": ["tutorials", "python", "education"],
      "read_time": "8 min read",
      "status": "published",
      "views": 892,
      "featured": false
    },
    {
      "id": 3,
      "title": "Cyber Scallywags Hackathon 2026: Get ready to innovate!",
      "slug": "hackathon-2026-preview",
      "excerpt": "It will be an incredible weekend! Our annual hackathon brought together 120+ developers, designers, and innovators. Watch out for the amazing projects and see who wins.",
      "content": "Event: hackathon 2026 preview...",
      "author": {
        "name": "Fran Moore-Hill",
        "avatar": "/static/images/team/HairyCoo.jpeg",
        "bio": "Event Coordinator & UX Designer"
      },
      "published_date": "2025-10-15T09:00:00Z",
      "featured_image": "/static/images/logo/pogo.png",
      "tags": ["events", "community", "innovation"],
      "read_time": "6 min read",
      "status": "published",
      "views": 2103,
      "featured": true
    }
  ],
  "pagination": {
    "current_page": 1,
    "total_pages": 1,
    "total_posts": 3,
    "posts_per_page": 12
  }
};

// Blog functionality
class BlogManager {
  constructor() {
    this.blogs = blogData.blogs;
    this.filteredBlogs = [...this.blogs];
    this.currentPage = 1;
    this.postsPerPage = 6;
    this.init();
  }

  init() {
    this.renderBlogs();
    this.bindEvents();
  }

  bindEvents() {
    document.getElementById('searchInput').addEventListener('input', (e) => {
      this.filterBlogs(e.target.value, document.getElementById('tagFilter').value);
    });

    document.getElementById('tagFilter').addEventListener('change', (e) => {
      this.filterBlogs(document.getElementById('searchInput').value, e.target.value);
    });
  }

  filterBlogs(searchTerm = '', selectedTag = '') {
    this.filteredBlogs = this.blogs.filter(blog => {
      const matchesSearch = !searchTerm || 
        blog.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
        blog.excerpt.toLowerCase().includes(searchTerm.toLowerCase()) ||
        blog.author.name.toLowerCase().includes(searchTerm.toLowerCase());
      
      const matchesTag = !selectedTag || blog.tags.includes(selectedTag);
      
      return matchesSearch && matchesTag;
    });

    this.currentPage = 1;
    this.renderBlogs();
  }

  renderBlogs() {
    const startIndex = (this.currentPage - 1) * this.postsPerPage;
    const endIndex = startIndex + this.postsPerPage;
    const blogsToShow = this.filteredBlogs.slice(startIndex, endIndex);

    const blogGrid = document.getElementById('blogGrid');
    blogGrid.innerHTML = '';

    if (blogsToShow.length === 0) {
      blogGrid.innerHTML = '<div class="col-12 text-center"><p style="color: #C1E415; font-size: 1.2rem;">No blog posts found matching your criteria.</p></div>';
      return;
    }

    blogsToShow.forEach(blog => {
      const blogCard = this.createBlogCard(blog);
      blogGrid.appendChild(blogCard);
    });

    this.renderPagination();
  }

  createBlogCard(blog) {
    const col = document.createElement('div');
    col.className = 'col-12 col-md-6 col-lg-4';
    
    const publishedDate = new Date(blog.published_date);
    const authorInitials = blog.author.name.split(' ').map(n => n[0]).join('');

    col.innerHTML = `
      <article class="blog-card" onclick="window.location.href='/blog/${blog.slug}'">
        <div class="blog-featured-image">
          <img src="${blog.featured_image}" alt="${blog.title}">
        </div>
        <div class="blog-card-body">
          <h3 class="blog-title">${blog.title}</h3>
          <p class="blog-excerpt">${blog.excerpt}</p>
          <div class="blog-meta">
            <div class="author-info">
              <div class="author-avatar">${authorInitials}</div>
              <span>${blog.author.name}</span>
            </div>
            <span class="read-time">${blog.read_time}</span>
          </div>
          <div class="blog-tags">
            ${blog.tags.map(tag => `<span class="blog-tag">${tag}</span>`).join('')}
          </div>
        </div>
      </article>
    `;
    
    return col;
  }

  renderPagination() {
    const totalPages = Math.ceil(this.filteredBlogs.length / this.postsPerPage);
    const paginationNav = document.getElementById('paginationNav');
    
    if (totalPages <= 1) {
      paginationNav.innerHTML = '';
      return;
    }

    let paginationHTML = '';
    
    for (let i = 1; i <= totalPages; i++) {
      paginationHTML += `
        <li class="page-item ${i === this.currentPage ? 'active' : ''}">
          <button class="page-link" onclick="blogManager.goToPage(${i})" style="color: ${i === this.currentPage ? '#fff' : '#4006a7'}; background-color: ${i === this.currentPage ? '#4006a7' : '#fff'};">${i}</button>
        </li>
      `;
    }
    
    paginationNav.innerHTML = paginationHTML;
  }

  goToPage(page) {
    this.currentPage = page;
    this.renderBlogs();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}

// Initialize blog manager when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  window.blogManager = new BlogManager();
});
</script>

{% endblock %}